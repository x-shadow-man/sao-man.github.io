<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="code-55HKMllCks">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic%7CLobster+Two:300,300italic,400,400italic,700,700italic%7CAmita:300,300italic,400,400italic,700,700italic%7CMontserrat:300,300italic,400,400italic,700,700italic%7CPT+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-center-atom.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","width":300,"display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="九析">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="九析">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="九析">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>九析</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">九析</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">11</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">4</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">66</span></a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="九析"
      src="/images/bb.jpg">
  <p class="site-author-name" itemprop="name">九析</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">66</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E5%AE%89%E5%85%A8%E4%B9%8B%E5%8A%A0%E5%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bb.jpg">
      <meta itemprop="name" content="九析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九析">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 九析">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E5%AE%89%E5%85%A8%E4%B9%8B%E5%8A%A0%E5%AF%86/" class="post-title-link" itemprop="url">九析带你轻松完爆 Istio - 安全之加密</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-12 14:28:41 / 修改时间：14:29:30" itemprop="dateCreated datePublished" datetime="2021-09-12T14:28:41+08:00">2021-09-12</time>
    </span>

  
    <span id="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E5%AE%89%E5%85%A8%E4%B9%8B%E5%8A%A0%E5%AF%86/" class="post-meta-item leancloud_visitors" data-flag-title="九析带你轻松完爆 Istio - 安全之加密" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1 前言</p>
<p>2 邀约</p>
<p>3 加密简介</p>
<p>4  Hash</p>
<hr>
<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>&emsp;&emsp;如果你对博客有任何疑问，请告诉我。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1591356282457280.png" alt="第四十章 九析带你轻松完爆 Istio - 安全之加密_Istio 免费视频。"></p>
<hr>
<h1 id="2-邀约"><a href="#2-邀约" class="headerlink" title="2 邀约"></a>2 邀约</h1><p>&emsp;&emsp;你可以从 b 站搜索 “九析”，获取免费的、更生动的视频资料：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1591356289184711.png" alt="第四十章 九析带你轻松完爆 Istio - 安全之加密_Istio 免费视频。_02"></p>
<hr>
<h1 id="3-加密简介"><a href="#3-加密简介" class="headerlink" title="3 加密简介"></a>3 加密简介</h1><p>&emsp;&emsp;加密是基础，是安全绕不开的话题。常用的加密方式有三种，分别为哈希、对称加密和非对称加密。下面分别进行介绍。</p>
<hr>
<h1 id="4-Hash"><a href="#4-Hash" class="headerlink" title="4  Hash"></a>4  Hash</h1><p>&emsp;&emsp;哈希（Hash），又称散列，是数据无法恢复的一项加密技术。比如字符串 “qingsongwanbao” 经过 md5 加密后的结果就是 “a90d298c15992ad107dfafca1f1deb9c”。如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1591356351862148.png" alt="第四十章 九析带你轻松完爆 Istio - 安全之加密_Istio 加密_04"></p>
<p>&emsp;&emsp;哈希后的结果一般情况下是不可逆的，也就是说无法根据 “a90d298c15992ad107dfafca1f1deb9c” 根据算法推导出 “qingsongwanbao”  。哈希经常的使用场景是密码。用户注册网站会员，在保存密码时就可以使用哈希，这样做即使数据库泄露，哈希后的密码被黑客获取，仍然无法推导出用户的明文密码。过程如下图所示：</p>
<p>&emsp;&emsp;用户注册：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1591356359876615.png" alt="第四十章 九析带你轻松完爆 Istio - 安全之加密_Istio 加密_06"></p>
<p>&emsp;&emsp;数据库被黑，用户名（hongxing）和散列后密码（5ea79ec42b3c05ec3b530276d83b3961）被盗，黑客通过盗取的用户名、散列后的密码登录，散列后的密码会再经过 Hash 变成一个新的密码值，此时就无法跟数据库原先的信息进行匹配，进而无法通过鉴权，也就无法登录网站和进行下一步操作。</p>
<p>Hash 还常用在网站的 cookie 里，如下所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1591356369229019.png" alt="第四十章 九析带你轻松完爆 Istio - 安全之加密_Istio 免费视频。_07"></p>
<p>&emsp;&emsp;常用的 Hash 算法有：md5、sha256、sha512 等。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-SSL-%E4%B8%8E-TLS-%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bb.jpg">
      <meta itemprop="name" content="九析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九析">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 九析">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-SSL-%E4%B8%8E-TLS-%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">九析带你轻松完爆 Istio - SSL 与 TLS 简介</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-12 14:25:40 / 修改时间：14:26:35" itemprop="dateCreated datePublished" datetime="2021-09-12T14:25:40+08:00">2021-09-12</time>
    </span>

  
    <span id="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-SSL-%E4%B8%8E-TLS-%E7%AE%80%E4%BB%8B/" class="post-meta-item leancloud_visitors" data-flag-title="九析带你轻松完爆 Istio - SSL 与 TLS 简介" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1 前言</p>
<p>2 邀约</p>
<p>3 SSL / TLS 介绍</p>
<p>4 SSL / TLS 作用</p>
<p>5 SSL / TLS 历史</p>
<p>6 SSL / TLS 样例</p>
<hr>
<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>&emsp;&emsp;如果你对博客有任何疑问，请告诉我。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1591183354270680.png" alt="第三十九章 九析带你轻松完爆 Istio - SSL 与 TLS 简介_Istio 教程"></p>
<hr>
<h1 id="2-邀约"><a href="#2-邀约" class="headerlink" title="2 邀约"></a>2 邀约</h1><p>&emsp;&emsp;你可以从 b 站搜索 “九析”，获取免费的、更生动的视频资料：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1591183361270330.png" alt="第三十九章 九析带你轻松完爆 Istio - SSL 与 TLS 简介_Istio 视频_02"></p>
<hr>
<h1 id="3-SSL-TLS-介绍"><a href="#3-SSL-TLS-介绍" class="headerlink" title="3 SSL / TLS 介绍"></a>3 SSL / TLS 介绍</h1><p>&emsp;&emsp;对朋友有一个遗憾，至今都感到愧疚。</p>
<p>&emsp;&emsp;他曾是我初中的一个好友，在那个情窦初开的年级，他无可救药地爱上了一个女孩。他一直纠结到底该不该表白，无数个夜里，他鼻涕一把泪一把向我诉说对她的思念。我实在厌烦他的婆妈，于是便敷衍他，要是实在害羞不敢面对，那就干脆写个纸条，我代为转交。他想了想，加上我不停地怂恿和酒精的作用，他就照办了。纸条写好后，他郑重其事封装好交道我手中。</p>
<p>&emsp;&emsp;我拿着他的信回到家，想都没想就打开了，上面只有一行字：“我爱你”。我看了看，然后加了两个字“妹妹”。</p>
<p>&emsp;&emsp;结果我的朋友被骂了三年流氓，直到他初中毕业。因为那个女孩的妹妹才10岁。</p>
<p>&emsp;&emsp;好吧，这一切都是我瞎掰的，为的就是解释 SSL / TLS。</p>
<p>&emsp;&emsp;SSL / TLS 就是为了解决端到端通讯的信息泄露以及篡改等安全问题。它位于传输层和应用层之间。应用层的数据是明文，传输层解决的是端到端的数据可到达，而 SSL / TLS 层则处理明文数据在传递过程中的安全和可靠。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1591183384588435.png" alt="第三十九章 九析带你轻松完爆 Istio - SSL 与 TLS 简介_Istio 安全_03"></p>
<hr>
<h1 id="4-SSL-TLS-作用"><a href="#4-SSL-TLS-作用" class="headerlink" title="4 SSL / TLS 作用"></a>4 SSL / TLS 作用</h1><p>&emsp;&emsp;SSL / TLS 主要解决三个网络问题：</p>
<blockquote>
<p>保密：所有通信信息通过加密处理，防止第三方嗅探</p>
<p>完整：通过 MAC 校验机制，一旦被篡改，通信双方会立刻发现</p>
<p>认证：双方认证，双方都可以配备证书，防止身份被冒充</p>
</blockquote>
<p>&emsp;&emsp;就像我们经常看到的谍战片，不相识的特工见面首先都会拿本书或者花（认证），双方对话都是云里雾里的话（加密），谈话内容一旦出现偏差立刻会有所警觉（完整）。</p>
<hr>
<h1 id="5-SSL-TLS-历史"><a href="#5-SSL-TLS-历史" class="headerlink" title="5 SSL / TLS 历史"></a>5 SSL / TLS 历史</h1><blockquote>
<p>1995 年，SSL 2.0，NetScape 提出。后因为安全问题废弃。</p>
<p>1996 年，SSL 3.0，也因为安全问题必须禁用。</p>
<p>1999 年，TLS 1.0，互联网标准化组织接替 NetScape 公司，发布了 SSL 3.0 升级版 TLS 1.0。</p>
<p>2006 年，TLS 1.1 发布。</p>
<p>2008 年，TLS 1.2 发布。目前主要使用该版本。</p>
<p>2018 年，TLS 1.3 发布。</p>
</blockquote>
<p>&emsp;&emsp;总结如下：</p>
<blockquote>
<p>SSL 2.0 -&gt; SSL 3.0 -&gt; TLS 1.0 -&gt; TLS 1.1 -&gt; TLS 1.2 -&gt; TLS 1.3</p>
</blockquote>
<hr>
<h1 id="6-SSL-TLS-样例"><a href="#6-SSL-TLS-样例" class="headerlink" title="6 SSL / TLS 样例"></a>6 SSL / TLS 样例</h1><p>&emsp;&emsp;curl 工具支持多种安全层协议，我们可以通过 –help 进行查看，截图如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1591183398580008.png" alt="第三十九章 九析带你轻松完爆 Istio - SSL 与 TLS 简介_Istio security_04"></p>
<p>&emsp;&emsp;下面可以针对多种协议进行访问：</p>
<blockquote>
<p>curl <a target="_blank" rel="noopener" href="https://www.baidu.com/">https://www.baidu.com</a> –tlsv1.0</p>
<p>curl <a target="_blank" rel="noopener" href="https://www.baidu.com/">https://www.baidu.com</a> –tlsv1.1</p>
<p>curl <a target="_blank" rel="noopener" href="https://www.baidu.com/">https://www.baidu.com</a> –tlsv1.2</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-Fortio%E3%80%81Circuit-breakers-%E6%96%AD%E8%B7%AF%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bb.jpg">
      <meta itemprop="name" content="九析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九析">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 九析">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-Fortio%E3%80%81Circuit-breakers-%E6%96%AD%E8%B7%AF%E5%99%A8/" class="post-title-link" itemprop="url">九析带你轻松完爆 Istio - Fortio、Circuit breakers 断路器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-12 14:22:19 / 修改时间：14:23:20" itemprop="dateCreated datePublished" datetime="2021-09-12T14:22:19+08:00">2021-09-12</time>
    </span>

  
    <span id="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-Fortio%E3%80%81Circuit-breakers-%E6%96%AD%E8%B7%AF%E5%99%A8/" class="post-meta-item leancloud_visitors" data-flag-title="九析带你轻松完爆 Istio - Fortio、Circuit breakers 断路器" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1 前言</p>
<p>2 邀约</p>
<p>3 Circuit breakers 断路器介绍</p>
<p>4 Circuit breakers 实例</p>
<p>  4.1 jiuxi-deploy.yaml</p>
<p>  4.2 jiuxi-svc.yaml</p>
<p>  4.3 jiuxi-dr.yaml</p>
<p>5 Circuit breakers 实例部署</p>
<p>  5.1 Istio 注入</p>
<p>  5.2 部署其他资源文件</p>
<p>6 验证断路器功能</p>
<hr>
<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>&emsp;&emsp;如果你对博客有任何疑问，请告诉我。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590659334512568.png" alt="第三十八章 九析带你轻松完爆 Istio - Fortio、Circuit breakers 断路器_Istio 教程"></p>
<hr>
<h1 id="2-邀约"><a href="#2-邀约" class="headerlink" title="2 邀约"></a>2 邀约</h1><p>&emsp;&emsp;你可以从 b 站搜索 “九析”，获取免费的、更生动的视频资料：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590659342792972.png" alt="第三十八章 九析带你轻松完爆 Istio - Fortio、Circuit breakers 断路器_Istio circuits_02"></p>
<hr>
<h1 id="3-Circuit-breakers-断路器介绍"><a href="#3-Circuit-breakers-断路器介绍" class="headerlink" title="3 Circuit breakers 断路器介绍"></a>3 Circuit breakers 断路器介绍</h1><p>&emsp;&emsp;印象里，很多年前，居民区靠街有一种门面房。屋子不大，粉色的灯光，开放式的推拉门。门口总是坐着一个美丽的大姐姐，每当我从路边经过，她都会露出热情的微笑。“帅哥进来玩啊”。印象中，这是她经常对我说的话。</p>
<p>&emsp;&emsp;那时，我还很年轻，还很帅，我觉得她一定是不可救药地爱上我了，直到有一天我看到了我不愿意看到的一幕。</p>
<p>&emsp;&emsp;还记得是一个夏日的傍晚，我刚加班完回出租房，路上又经过了她的小屋，大老远就听到她温柔的声音：“帅哥来玩啊”。连日的工作劳累让我疲惫不堪，当我终于鼓足勇气准备接受她的邀请、迎接她的感情时，忽然从身后传来一个沙哑的声音：“来了”。我回头一看，原来是一个民工打扮的人。那一刻，我觉得自己像是被耍了一样，落荒而逃。</p>
<p>&emsp;&emsp;后来，我经常看到有民工模样的人走进那扇落地窗开拉门，有时有好几个，每当这个时候，我都会看到小姐姐会把开拉门从里面锁好，然后再把厚厚的窗帘放下……</p>
<p>&emsp;&emsp;慢慢地，当我社会阅历丰富，我终于知道了大姐姐的职业，为人民服务。</p>
<p>&emsp;&emsp;而记忆中的推拉门，竟是她一个弱女子面对这个世界的安全保障，是她对过载请求的一种天然防护，就像我经常使用的断路器一样。</p>
<p>&emsp;&emsp;断路器是 Istio 提供的一个有用的技术。在微服务设置断路器可以有效保障微服务的抗操性。比如在断路器中，你可以设置服务并发连接次数限制或者服务调用失败次数，一旦达到设置的阈值，断路器将“跳闸”并停止与该主机的进一步连接。</p>
<p>&emsp;&emsp;因为断路器适用于负载平衡池中“真正”的服务网格（Istio 资源注入后的 Pod），因此可以在 Destination Rule 配置断路器，而 Destination Rule 最终会被翻译成  Envoy 的配置，然后作用在 Envoy 上。这样当流量进入到被 Istio 注入后的 Pod，流量就会被 Envoy  拦截，这样断路器就会针对流量发生作用。</p>
<hr>
<h1 id="4-Circuit-breakers-实例"><a href="#4-Circuit-breakers-实例" class="headerlink" title="4 Circuit breakers 实例"></a>4 Circuit breakers 实例</h1><p>&emsp;&emsp;本实例用到 3 个资源文件：</p>
<blockquote>
<p># Istio 注入后的目标 Pod 资源</p>
<p>jiuxi-deploy.yaml    </p>
<p># Istio 目标规则文件</p>
<p>jiuxi-dr.yaml</p>
<p># Pod 资源的对外服务</p>
<p>jiuxi-svc.yaml</p>
</blockquote>
<h2 id="4-1-jiuxi-deploy-yaml"><a href="#4-1-jiuxi-deploy-yaml" class="headerlink" title="4.1 jiuxi-deploy.yaml"></a>4.1 jiuxi-deploy.yaml</h2><p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590659353738215.png" alt="第三十八章 九析带你轻松完爆 Istio - Fortio、Circuit breakers 断路器_Istio 视频_04"></p>
<h2 id="4-2-jiuxi-svc-yaml"><a href="#4-2-jiuxi-svc-yaml" class="headerlink" title="4.2 jiuxi-svc.yaml"></a>4.2 jiuxi-svc.yaml</h2><p>&emsp;&emsp;该文件是对上面 deploy 文件的一个 service 暴露：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590659364599149.png" alt="第三十八章 九析带你轻松完爆 Istio - Fortio、Circuit breakers 断路器_Istio 断路器_06"></p>
<h2 id="4-3-jiuxi-dr-yaml"><a href="#4-3-jiuxi-dr-yaml" class="headerlink" title="4.3 jiuxi-dr.yaml"></a>4.3 jiuxi-dr.yaml</h2><p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590659385856602.png" alt="第三十八章 九析带你轻松完爆 Istio - Fortio、Circuit breakers 断路器_Istio 视频_07"></p>
<p>&emsp;&emsp;详细说明如下：</p>
<blockquote>
<p>http1MaxPendingRequests: http 请求挂起状态的最大请求数</p>
<p>maxRequestsPerConnection: 一定时间内限制对后端服务发起的最大请求数，如果超过了此配置，就会出现限流。</p>
<p>outlierDetection.consecutiveErrors: 拒绝连接的最大失败次数</p>
<p>outlierDetection.interval: 触发熔断的时间间隔，在 interval 时间间隔内，达到 consecutiveErrors 即触发熔断</p>
<p>outlierDetection.baseEjectionTime: 熔断时长</p>
<p>maxEjectionPercent: 熔断连接最大百分比</p>
</blockquote>
<hr>
<h1 id="5-Circuit-breakers-实例部署"><a href="#5-Circuit-breakers-实例部署" class="headerlink" title="5 Circuit breakers 实例部署"></a>5 Circuit breakers 实例部署</h1><h2 id="5-1-Istio-注入"><a href="#5-1-Istio-注入" class="headerlink" title="5.1 Istio 注入"></a>5.1 Istio 注入</h2><p>&emsp;&emsp;对 jiuxi-deploy.yaml 文件进行 Istio 注入：</p>
<blockquote>
<p>istioctl kube-inject -f jiuxi-deploy.yaml | kubectl apply -f -</p>
</blockquote>
<p>&emsp;&emsp;执行成功后的结果如下：<img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590659394818991.png" alt="第三十八章 九析带你轻松完爆 Istio - Fortio、Circuit breakers 断路器_Istio 教程_09"></p>
<p>&emsp;&emsp;发现 nginx 容器个数已经是 2 个，就说明注入成功了。</p>
<h2 id="5-2-部署其他资源文件"><a href="#5-2-部署其他资源文件" class="headerlink" title="5.2 部署其他资源文件"></a>5.2 部署其他资源文件</h2><p>&emsp;&emsp;直接部署 jiuxi-svc.yaml 和 jiuxi-dr.yaml：</p>
<blockquote>
<p>kubectl apply -f jiuxi-dr.yaml</p>
<p>kubectl apply -f jiuxi-svc.yaml</p>
</blockquote>
<p>&emsp;&emsp;自此，整个实例部署成功。</p>
<hr>
<h1 id="6-验证断路器功能"><a href="#6-验证断路器功能" class="headerlink" title="6 验证断路器功能"></a>6 验证断路器功能</h1><p>&emsp;&emsp;使用 Istio 的负载测试工具 Fortio，有关 Fortio 的安装和使用，请参考我上章的内容，分分钟容易到爆。</p>
<p>&emsp;&emsp;执行如下命令：</p>
<blockquote>
<p>fortio load -c 10 -n 50 -qps 0 <a target="_blank" rel="noopener" href="http://10.103.150.90/">http://10.103.150.90</a> (CLUSTER_IP:PORT)</p>
</blockquote>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590659409585223.png" alt="第三十八章 九析带你轻松完爆 Istio - Fortio、Circuit breakers 断路器_Istio circuits_10"></p>
<p>&emsp;&emsp;执行结果如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590659417525055.png" alt="第三十八章 九析带你轻松完爆 Istio - Fortio、Circuit breakers 断路器_Istio 断路器_11"></p>
<p>&emsp;&emsp;从执行结果来看，有 27 个报错。 说明断路器生效。</p>
<p>&emsp;&emsp;自此，九析带你轻松完爆 Fortio、Circuit breakers 断路器功能。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-Fortio-%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bb.jpg">
      <meta itemprop="name" content="九析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九析">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 九析">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-Fortio-%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">九析带你轻松完爆 Istio - Fortio 部署</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-12 10:54:01 / 修改时间：10:54:40" itemprop="dateCreated datePublished" datetime="2021-09-12T10:54:01+08:00">2021-09-12</time>
    </span>

  
    <span id="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-Fortio-%E9%83%A8%E7%BD%B2/" class="post-meta-item leancloud_visitors" data-flag-title="九析带你轻松完爆 Istio - Fortio 部署" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1 前言</p>
<p>2 邀约</p>
<p>3 Fortio 介绍</p>
<p>4 Fortio 下载</p>
<p>5 Fortio 命令行</p>
<p>6 Fortio web 控制台方式</p>
<hr>
<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>​    如果你对博客有任何疑问，请告诉我。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590632941354098.png" alt="第三十七章 九析带你轻松完爆 Istio - Fortio 部署_Istio 学习"></p>
<hr>
<h1 id="2-邀约"><a href="#2-邀约" class="headerlink" title="2 邀约"></a>2 邀约</h1><p>​    你可以从 b 站搜索 “九析”，获取免费的、更生动的视频资料：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590632951668869.png" alt="第三十七章 九析带你轻松完爆 Istio - Fortio 部署_Istio 免费 视频_02"></p>
<hr>
<h1 id="3-Fortio-介绍"><a href="#3-Fortio-介绍" class="headerlink" title="3 Fortio 介绍"></a>3 Fortio 介绍</h1><p>​    Fortio 是 Istio 的负载测试工具，它提供了 web 控制台和命令行控制台的操作方式。因为后期我们在 Istio 断路器介绍中会使用到 Fortio，因此这节需要对 Fortio 进行安装和简单地操作。</p>
<hr>
<h1 id="4-Fortio-下载"><a href="#4-Fortio-下载" class="headerlink" title="4 Fortio 下载"></a>4 Fortio 下载</h1><p>​    推荐使用 Fortio 的命令行操作方式，因此我们选择 rpm 的安装方式。</p>
<blockquote>
<p>curl -L <a target="_blank" rel="noopener" href="https://github.com/fortio/fortio/releases/download/v1.3.1/fortio-1.3.1-1.x86_64.rpm">https://github.com/fortio/fortio/releases/download/v1.3.1/fortio-1.3.1-1.x86_64.rpm</a> -o fortio-1.3.1-1.x86_64.rpm</p>
<p>rpm -ivh fortio-1.3.1-1.x86_64.rpm</p>
</blockquote>
<hr>
<h1 id="5-Fortio-命令行"><a href="#5-Fortio-命令行" class="headerlink" title="5 Fortio 命令行"></a>5 Fortio 命令行</h1><p>​    执行如下语句向百度进行负载压测。</p>
<blockquote>
<p>fortio load -c 5 -n 20 -qps 0 <a target="_blank" rel="noopener" href="http://www.baidu.com/"> http://www.baidu.com</a></p>
</blockquote>
<blockquote>
<p># 命令解释如下：</p>
<p># -c 表示并发数</p>
<p># -n 一共多少请求</p>
<p># -qps 每秒查询数，0 表示不限制</p>
</blockquote>
<p>​    命令执行的结果如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590632961627818.png" alt="第三十七章 九析带你轻松完爆 Istio - Fortio 部署_Istio Fortio_04"></p>
<hr>
<h1 id="6-Fortio-web-控制台方式"><a href="#6-Fortio-web-控制台方式" class="headerlink" title="6 Fortio web 控制台方式"></a>6 Fortio web 控制台方式</h1><p>​    web 控制台方式就是提供给习惯使用 web 界面操作的同学一个途径来使用 Fortio。因为是基于 web 方式，所以就需要首先启动一个 web  server，这样客户端浏览器才可以访问到 web server 提供的操作界面进行负载压测。</p>
<blockquote>
<p>nohup fortio server &amp;</p>
</blockquote>
<p>​    默认情况 fortio server 会启动 8080 端口，如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590632971586578.png" alt="第三十七章 九析带你轻松完爆 Istio - Fortio 部署_Istio 学习_05"></p>
<p>​    打开浏览器，输入 <a target="_blank" rel="noopener" href="http://ip:8080/fortio%EF%BC%8C%E8%AE%BF%E9%97%AE">http://IP:8080/fortio，访问</a> Fortio server：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590632982971129.png" alt="第三十七章 九析带你轻松完爆 Istio - Fortio 部署_Istio 免费 视频_07"></p>
<p>​    直接点击“start”按钮，将会看到压测效果：<img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590632992841011.png" alt="第三十七章 九析带你轻松完爆 Istio - Fortio 部署_Istio Fortio_09">   自此，九析带你轻松完爆了 Istio Fortio 负载压测工具。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E7%BD%91%E7%BB%9C%E5%BC%B9%E6%80%A7%E4%B9%8B%E9%87%8D%E8%AF%95%EF%BC%88retry%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bb.jpg">
      <meta itemprop="name" content="九析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九析">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 九析">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E7%BD%91%E7%BB%9C%E5%BC%B9%E6%80%A7%E4%B9%8B%E9%87%8D%E8%AF%95%EF%BC%88retry%EF%BC%89/" class="post-title-link" itemprop="url">九析带你轻松完爆 Istio - 网络弹性之重试（retry）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-12 10:51:22 / 修改时间：10:52:00" itemprop="dateCreated datePublished" datetime="2021-09-12T10:51:22+08:00">2021-09-12</time>
    </span>

  
    <span id="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E7%BD%91%E7%BB%9C%E5%BC%B9%E6%80%A7%E4%B9%8B%E9%87%8D%E8%AF%95%EF%BC%88retry%EF%BC%89/" class="post-meta-item leancloud_visitors" data-flag-title="九析带你轻松完爆 Istio - 网络弹性之重试（retry）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1 前言</p>
<p>2 邀约</p>
<p>3 网络弹性介绍</p>
<p>4 重试介绍</p>
<p>5 重试样例</p>
<p>  5.1 jiuxi-client.yaml 文件</p>
<p>  5.2 jiuxi-deploy.yaml</p>
<p>  5.3 jiuxi-svc.yaml</p>
<p>  5.4 jiuxi-vs.yaml</p>
<p>6 重试实例部署</p>
<p>  6.1 Istio 注入</p>
<p>  6.2 部署 k8s service</p>
<p>  6.3 部署 Istio 虚拟服务</p>
<p>7 重试实例设置</p>
<p>8 重试实例验证</p>
<hr>
<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>​    如果你对博客有任何疑问，请告诉我。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590485793878575.png" alt="第三十六章 九析带你轻松完爆 Istio - 网络弹性之重试（retry）_Istio 教程"></p>
<hr>
<h1 id="2-邀约"><a href="#2-邀约" class="headerlink" title="2 邀约"></a>2 邀约</h1><p>​    你可以从 b 站搜索 “九析”，获取免费的、更生动的视频资料：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590485800450604.png" alt="第三十六章 九析带你轻松完爆 Istio - 网络弹性之重试（retry）_Istio retry_02"></p>
<hr>
<h1 id="3-网络弹性介绍"><a href="#3-网络弹性介绍" class="headerlink" title="3 网络弹性介绍"></a>3 网络弹性介绍</h1><p>​    网络弹性也称为运维弹性，是指网络在遇到灾难事件时快速恢复和继续运行的能力。灾难事件的范畴很广泛，比如长时间停电、网络设备故障、恶意入侵等。</p>
<hr>
<h1 id="4-重试介绍"><a href="#4-重试介绍" class="headerlink" title="4 重试介绍"></a>4 重试介绍</h1><p>​    你爱上一个玉女，你想把她变成欲女。于是你疯狂地追求了她。第一次，她拒绝了，你不死心；你又追求她第二次，结果她又拒绝了你，你依旧不死心；你又追求她第三次，结果她又拒绝了你，这次你不再死缠烂打，你改变了策略。你去了整型医院，你整成她的模样，结果你在夜深人静的时候你对着镜子疯狂爱抚自己。你胜利了。</p>
<p>很多时候，换个角度，也许你就可以解决问题，只是很多人都想不到而已……</p>
<p>​    好了，不扯淡了。言归正传。</p>
<p>​    Istio 重试机制就是如果调用服务失败，Envoy 代理尝试连接服务的最大次数。而默认情况下，Envoy 代理在失败后并不会尝试重新连接服务，除非我们启动 Istio 重试机制。</p>
<hr>
<h1 id="5-重试样例"><a href="#5-重试样例" class="headerlink" title="5 重试样例"></a>5 重试样例</h1><p>​    本样例中在一次调用服务失败后最多配 3 次重试。</p>
<p>​    本样例需要结合 Istio 故障注入模拟被调用服务宕机，假如不了解故障注入也没关系，直接执行我的样例就行。下面先展示一下整个实例的架构图：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590485808816801.png" alt="第三十六章 九析带你轻松完爆 Istio - 网络弹性之重试（retry）_Istio 重试_04"></p>
<p>​    架构说明如下，本实例模拟客户端调用 nginx，nginx 将请求转发给 tomcat。tomcat 通过故障注入而中止对外服务，nginx 设置如果访问 tomcat 失败则会重试 3 次。</p>
<p>​    该实例资源文件一共有 4 个，分别如下：</p>
<blockquote>
<p>jiuxi-client.yaml</p>
<p>jiuxi-deploy.yaml</p>
<p>jiuxi-svc.yaml</p>
<p>jiuxi-vs.yaml</p>
</blockquote>
<h2 id="5-1-jiuxi-client-yaml-文件"><a href="#5-1-jiuxi-client-yaml-文件" class="headerlink" title="5.1 jiuxi-client.yaml 文件"></a>5.1 jiuxi-client.yaml 文件</h2><p>​    资源内容如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590485817157460.png" alt="第三十六章 九析带你轻松完爆 Istio - 网络弹性之重试（retry）_Istio 教程_06"></p>
<h2 id="5-2-jiuxi-deploy-yaml"><a href="#5-2-jiuxi-deploy-yaml" class="headerlink" title="5.2 jiuxi-deploy.yaml"></a>5.2 jiuxi-deploy.yaml</h2><p>​    内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590485824954620.png" alt="第三十六章 九析带你轻松完爆 Istio - 网络弹性之重试（retry）_Istio 视频_08"></p>
<h2 id="5-3-jiuxi-svc-yaml"><a href="#5-3-jiuxi-svc-yaml" class="headerlink" title="5.3 jiuxi-svc.yaml"></a>5.3 jiuxi-svc.yaml</h2><p>​    内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590485831239422.png" alt="第三十六章 九析带你轻松完爆 Istio - 网络弹性之重试（retry）_Istio 重试_10"></p>
<h2 id="5-4-jiuxi-vs-yaml"><a href="#5-4-jiuxi-vs-yaml" class="headerlink" title="5.4 jiuxi-vs.yaml"></a>5.4 jiuxi-vs.yaml</h2><p>​    内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590485836248871.png" alt="第三十六章 九析带你轻松完爆 Istio - 网络弹性之重试（retry）_Istio retires_12"></p>
<p>​    此虚拟服务有两个知识点。</p>
<p>​    第一：故障注入。该虚拟服务的作用对象就是 tomcat-svc。使用此故障注入后，在网格中该 tomcat 就是不可用的。</p>
<blockquote>
<p>http:</p>
<p>- fault:</p>
<p>   abort:</p>
<p>​     percentage:</p>
<p>​       value: 100</p>
<p>​     httpStatus: 503</p>
</blockquote>
<p>​    该设置说明每次调用 tomcat-svc，都会调用失败，并且返回错误状态码 503。</p>
<p>​    第二：重试。代码如下：</p>
<blockquote>
<p>http:</p>
<p>- route:</p>
<p>  - destination:</p>
<p>​     host: nginx-svc</p>
<p>  reties:</p>
<p>   attempts: 3</p>
</blockquote>
<p>​    该设置说明每次调用 nginx-svc，如果调用失败的话就会重试 3 次。</p>
<hr>
<h1 id="6-重试实例部署"><a href="#6-重试实例部署" class="headerlink" title="6 重试实例部署"></a>6 重试实例部署</h1><h2 id="6-1-Istio-注入"><a href="#6-1-Istio-注入" class="headerlink" title="6.1 Istio 注入"></a>6.1 Istio 注入</h2><p>​    需要对 client 和 deploy 资源进行 Istio 注入，将 client、nginx、tomcat 都放到网格中。本人是手工注入 Istio，如果你设置了自动资源注入也不会有影响，一样可以轻松完爆。</p>
<blockquote>
<p>istioctl kube-inject -f jiuxi-client.yaml | kubectl apply -f -</p>
<p>istioctl kube-inject -f jiuxi-deploy.yaml | kubectl apply -f -</p>
</blockquote>
<p>​    执行成功后，通过 kubectl get pods 查看 Istio 注入情况：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590485851519677.png" alt="第三十六章 九析带你轻松完爆 Istio - 网络弹性之重试（retry）_Istio retry_14"></p>
<h2 id="6-2-部署-k8s-service"><a href="#6-2-部署-k8s-service" class="headerlink" title="6.2 部署 k8s service"></a>6.2 部署 k8s service</h2><p>​    部署 jiuxi-svc.yaml：</p>
<blockquote>
<p>kubectl apply -f jiuxi-svc.yaml</p>
</blockquote>
<h2 id="6-3-部署-Istio-虚拟服务"><a href="#6-3-部署-Istio-虚拟服务" class="headerlink" title="6.3 部署 Istio 虚拟服务"></a>6.3 部署 Istio 虚拟服务</h2><p>​    部署 jiuxi-vs.yaml</p>
<blockquote>
<p>kubectl apply -f jiuxi-vs.yaml</p>
</blockquote>
<hr>
<h1 id="7-重试实例设置"><a href="#7-重试实例设置" class="headerlink" title="7 重试实例设置"></a>7 重试实例设置</h1><p>​    因为要用到 nginx 到 tomcat 的转发功能，因此需要对 nginx 做一些设置：</p>
<p>​    登录 nginx pod：</p>
<blockquote>
<p>kubectl exec -it nginx-7559f7d487-79q9p – sh</p>
</blockquote>
<p>​    编辑 nginx 配置文件：</p>
<blockquote>
<p>vi /etc/nginx/conf.d/default.conf</p>
</blockquote>
<p>​    添加和修改如下内容：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590485861546663.png" alt="第三十六章 九析带你轻松完爆 Istio - 网络弹性之重试（retry）_Istio 重试_16"></p>
<p>​    编辑完成后，再执行如下语句验证配置和让配置生效：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590485869612451.png" alt="第三十六章 九析带你轻松完爆 Istio - 网络弹性之重试（retry）_Istio retires_18"></p>
<p>​    自此，整个样例配置和部署完毕。</p>
<hr>
<h1 id="8-重试实例验证"><a href="#8-重试实例验证" class="headerlink" title="8 重试实例验证"></a>8 重试实例验证</h1><p>​    登录 client，执行如下语句：</p>
<blockquote>
<p>kubectl exec -it client-5b77d5949f-nzdtl – sh # 别照抄本人 pod，根据各自情况修改</p>
</blockquote>
<p>​    执行如下语句：</p>
<blockquote>
<p>wget -q -O - <a target="_blank" rel="noopener" href="http://nginx-svc/"> http://nginx-svc</a></p>
</blockquote>
<p>​    执行如下语句首先将 nginx 的日志打印到控制台：</p>
<blockquote>
<p>kubectl logs -f nginx-7559f7d487-79q9p -c istio-proxy</p>
</blockquote>
<p>​    执行结果如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590485878604489.png" alt="第三十六章 九析带你轻松完爆 Istio - 网络弹性之重试（retry）_Istio retires_20"></p>
<p>​    由上图可知，重试设置生效。</p>
<p>​    自此，九析带你轻松完爆了 Istio 的重试（retry）机制。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E7%BD%91%E7%BB%9C%E5%BC%B9%E6%80%A7%E4%B9%8B%E8%B6%85%E6%97%B6%EF%BC%88timeout%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bb.jpg">
      <meta itemprop="name" content="九析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九析">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 九析">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E7%BD%91%E7%BB%9C%E5%BC%B9%E6%80%A7%E4%B9%8B%E8%B6%85%E6%97%B6%EF%BC%88timeout%EF%BC%89/" class="post-title-link" itemprop="url">九析带你轻松完爆 Istio - 网络弹性之超时（timeout）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-12 10:46:14 / 修改时间：10:47:35" itemprop="dateCreated datePublished" datetime="2021-09-12T10:46:14+08:00">2021-09-12</time>
    </span>

  
    <span id="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E7%BD%91%E7%BB%9C%E5%BC%B9%E6%80%A7%E4%B9%8B%E8%B6%85%E6%97%B6%EF%BC%88timeout%EF%BC%89/" class="post-meta-item leancloud_visitors" data-flag-title="九析带你轻松完爆 Istio - 网络弹性之超时（timeout）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1 前言</p>
<p>2 邀约</p>
<p>3 网络弹性介绍</p>
<p>4 超时时间</p>
<p>5 Istio 超时实例</p>
<p>5.1    jiuxi-client.yaml 文件</p>
<p>5.2 jiuxi-deploy.yaml</p>
<p>5.3 jiuxi-svc.yaml</p>
<p>5.4 jiuxi-vs.yaml</p>
<p>6 超时实例部署</p>
<p>6.1 Istio 注入</p>
<p>6.2 部署 k8s service:</p>
<p>6.3 部署 Istio 虚拟服务：</p>
<p>7 超时实例设置</p>
<p>8 超时实例验</p>
<hr>
<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>​    如果你对博客有任何疑问，请告诉我。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590378990221451.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_istio 教程"></p>
<hr>
<h1 id="2-邀约"><a href="#2-邀约" class="headerlink" title="2 邀约"></a>2 邀约</h1><p>​    你可以从 b 站搜索 “九析”，获取免费的、更生动的视频资料：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590378998739752.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_Istio 超时_02"></p>
<hr>
<h1 id="3-网络弹性介绍"><a href="#3-网络弹性介绍" class="headerlink" title="3 网络弹性介绍"></a>3 网络弹性介绍</h1><p>​    网络弹性也称为运维弹性，是指网络在遇到灾难事件时快速恢复和继续运行的能力。灾难事件的范畴很广泛，比如长时间停电、网络设备故障、恶意入侵等。</p>
<hr>
<h1 id="4-超时时间"><a href="#4-超时时间" class="headerlink" title="4 超时时间"></a>4 超时时间</h1><p>​    工作中常常会碰到这样的开发、测试场景，比如：“对方处理请求时间过长，没有及时响应，我们的程序要怎么处理来确保不会无限期地等待”。常见的处理方式是被调用方使用 sleep  语句模拟响应时间过长，调用方设定请求超时时间过短，来造成请求超时的结果。但是这种处理方法有很多的弊端，第一：本属于网络弹性层的东西，却需要在代码中体现；第二：超时时间设置过长可能导致过多的延迟、设置过短可能导致不必要的失败，因此超时时间需要动态调整。基于上面两个弊端，Istio  使用虚拟服务来优雅实现超时处理。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590379008447397.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_Istio 超时_04"></p>
<hr>
<h1 id="5-Istio-超时实例"><a href="#5-Istio-超时实例" class="headerlink" title="5 Istio 超时实例"></a>5 Istio 超时实例</h1><p>​    本实例需要结合 Istio 故障注入模拟被调用方响应请求慢的场景，有关 Istio 失败注入之延迟请参考本人的另外一篇<a target="_blank" rel="noopener" href="https://blog.51cto.com/14625168/2496878"> 博文</a>，简单到让你分分钟轻松完爆。</p>
<p>​    该实例的架构图如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590379015698550.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_Istio 故障注入_06"></p>
<p>​    架构说明如下，本实例就是模拟客户端调用 nginx，nginx 将请求转发给 tomcat 的常见功能。tomcat 响应请求设置为 5s（通过故障注入实现，相当于 sleep 5s 逻辑），nginx 设置 client 的请求超时时间为 2s。因为 nginx 需要在 2s 内返回给 client，而 nginx 请求  tomcat 却需要 5s，因此模拟 client 调用 nginx 超时的情景。</p>
<p>​    该实例资源文件一共有 4 个，分别如下：</p>
<blockquote>
<p>jiuxi-client.yaml    # 客户端资源</p>
<p>jiuxi-deploy.yaml    # nginx、tomcat 的 deployment 资源</p>
<p>jiuxi-svc.yaml        # nginx、tomcat 的 service 资源</p>
<p>jiuxi-vs.yaml        # Istio 虚拟资源</p>
</blockquote>
<h2 id="5-1-jiuxi-client-yaml-文件"><a href="#5-1-jiuxi-client-yaml-文件" class="headerlink" title="5.1    jiuxi-client.yaml 文件"></a>5.1    jiuxi-client.yaml 文件</h2><p>​    资源内容如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590379023441708.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_istio 视频_08"></p>
<h2 id="5-2-jiuxi-deploy-yaml"><a href="#5-2-jiuxi-deploy-yaml" class="headerlink" title="5.2 jiuxi-deploy.yaml"></a>5.2 jiuxi-deploy.yaml</h2><p>​    资源内容如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590379031255812.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_istio 视频_10"></p>
<h2 id="5-3-jiuxi-svc-yaml"><a href="#5-3-jiuxi-svc-yaml" class="headerlink" title="5.3 jiuxi-svc.yaml"></a>5.3 jiuxi-svc.yaml</h2><p>​    资源内容如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590379036583530.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_Istio timeout_12"></p>
<h2 id="5-4-jiuxi-vs-yaml"><a href="#5-4-jiuxi-vs-yaml" class="headerlink" title="5.4 jiuxi-vs.yaml"></a>5.4 jiuxi-vs.yaml</h2><p>​    Istio 虚拟服务资源内容如下所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590379043793457.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_istio 教程_14"></p>
<p>​    此虚拟服务有两个知识点。</p>
<p>​    第一：故障注入：</p>
<blockquote>
<p>http:</p>
<p>- fault:</p>
<p>   delay:</p>
<p>​     percentage:</p>
<p>​     value: 100</p>
<p>   fixedDelay: 5s</p>
</blockquote>
<p>​    该设置说明每次调用 tomcat-svc 的 k8s service，都会延迟 5s 才会调用。</p>
<p>​    第二：调用超时：</p>
<blockquote>
<p>hosts:</p>
<p>- nginx-svc</p>
<p>http:</p>
<p>- route:</p>
<p> - destination:</p>
<p>   host: nginx-svc</p>
<p>timeout: 2s</p>
</blockquote>
<p>​    该设置说明调用 nginx-svc 的 k8s service，请求超时时间是 2s。</p>
<hr>
<h1 id="6-超时实例部署"><a href="#6-超时实例部署" class="headerlink" title="6 超时实例部署"></a>6 超时实例部署</h1><p>​    在上面我们编写完样例，下面准备部署。</p>
<h2 id="6-1-Istio-注入"><a href="#6-1-Istio-注入" class="headerlink" title="6.1 Istio 注入"></a>6.1 Istio 注入</h2><p>​    需要对 client 和 deploy 资源文件进行 Istio 注入，将 client、nginx、tomcat 都放入到网格中。本人是手工注入 Istio 方式，如果你设置了自动 Istio 注入不会影响，一样可以轻松完爆。</p>
<blockquote>
<p>istioctl kube-inject -f jiuxi-client.yaml | kubectl apply -f -</p>
<p>istioctl kube-inject -f jiuxi-deploy.yaml | kubectl apply -f -</p>
</blockquote>
<p>​    执行成功后，通过 kubectl get pods 查看 Istio 注入情况：<img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590379054696222.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_istio 视频_16"></p>
<h2 id="6-2-部署-k8s-service"><a href="#6-2-部署-k8s-service" class="headerlink" title="6.2 部署 k8s service"></a>6.2 部署 k8s service</h2><p>​    部署 jiuxi-svc.yaml：</p>
<blockquote>
<p>kubectl apply -f jiuxi-svc.yaml</p>
</blockquote>
<h2 id="6-3-部署-Istio-虚拟服务"><a href="#6-3-部署-Istio-虚拟服务" class="headerlink" title="6.3 部署 Istio 虚拟服务"></a>6.3 部署 Istio 虚拟服务</h2><p>​    部署 jiuxi-vs.yaml:</p>
<blockquote>
<p>kubectl apply -f jiuxi-vs.yaml</p>
</blockquote>
<hr>
<h1 id="7-超时实例设置"><a href="#7-超时实例设置" class="headerlink" title="7 超时实例设置"></a>7 超时实例设置</h1><p>​    因为要用到 nginx 对 tomcat 的转发功能，因此需要对 nginx 做一些设置：</p>
<p>​    登录 nginx pod：</p>
<blockquote>
<p>kubectl exec -it nginx-7559f7d487-djzbb – sh</p>
</blockquote>
<p>​    编辑 nginx 配置文件：</p>
<blockquote>
<p>vi /etc/nginx/conf.d/default.conf</p>
</blockquote>
<p>​    添加和修改如下内容：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590379063523307.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_istio 视频_18"></p>
<p>​    编辑完后，再执行如下语句验证配置和让配置生效：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590379070550212.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_istio 教程_20"></p>
<p>​    自此，整个样例配置和部署完毕。</p>
<hr>
<h1 id="8-超时实例验证"><a href="#8-超时实例验证" class="headerlink" title="8 超时实例验证"></a>8 超时实例验证</h1><p>​    登录 client，执行如下语句：</p>
<blockquote>
<p>kubectl exec -it client-5b77d5949f-nzdtl – sh    # 别照抄本人 pod，根据各自情况修改</p>
</blockquote>
<p>​    执行如下语句：</p>
<blockquote>
<p>wget -q -O - <a target="_blank" rel="noopener" href="http://nginx-svc/"> http://nginx-svc</a></p>
</blockquote>
<p>​    执行结果如下所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1590379078144155.png" alt="第三十五章 九析带你轻松完爆 Istio - 网络弹性之超时（timeout）_istio 教程_22"></p>
<p>​    说明 timeout 样例运行成功。</p>
<p>​    也可以同样验证故障注入效果，执行如下语句：</p>
<blockquote>
<p>wget -q -O - <a target="_blank" rel="noopener" href="http://tomcat-svc:8080/"> http://tomcat-svc:8080</a></p>
</blockquote>
<p>​    执行效果是请求 5s 后才会返回，说明 Istio 故障注入（延迟 5s）运行成功。</p>
<p>​    自此，九析带你轻松完爆了 Istio。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-fault-injection-%E6%95%85%E9%9A%9C%E6%B3%A8%E5%85%A5%E4%B9%8B%E4%B8%AD%E6%AD%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bb.jpg">
      <meta itemprop="name" content="九析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九析">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 九析">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-fault-injection-%E6%95%85%E9%9A%9C%E6%B3%A8%E5%85%A5%E4%B9%8B%E4%B8%AD%E6%AD%A2/" class="post-title-link" itemprop="url">九析带你轻松完爆 Istio - fault injection 故障注入之中止</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-12 10:41:37 / 修改时间：10:42:16" itemprop="dateCreated datePublished" datetime="2021-09-12T10:41:37+08:00">2021-09-12</time>
    </span>

  
    <span id="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-fault-injection-%E6%95%85%E9%9A%9C%E6%B3%A8%E5%85%A5%E4%B9%8B%E4%B8%AD%E6%AD%A2/" class="post-meta-item leancloud_visitors" data-flag-title="九析带你轻松完爆 Istio - fault injection 故障注入之中止" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1 前言</p>
<p>2 邀约</p>
<p>3 故障注入之中止</p>
<p>4 Istio 故障注入之中止实例</p>
<p>  4.1 客户端资源文件</p>
<p>  4.2 k8s 服务文件</p>
<p>  4.3 部署工作负载（deployment）</p>
<p>  4.4 虚拟服务文件</p>
<p>5 验证故障注入</p>
<hr>
<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>​    如果你对博客有任何疑问，请告诉我。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589954813582556.png" alt="第三十四章 九析带你轻松完爆 Istio - fault injection 故障注入之中止_istio 视频"></p>
<hr>
<h1 id="2-邀约"><a href="#2-邀约" class="headerlink" title="2 邀约"></a>2 邀约</h1><p>​    你可以从 b 站搜索 “九析”，获取免费的、更生动的视频资料：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589954822606472.png" alt="第三十四章 九析带你轻松完爆 Istio - fault injection 故障注入之中止_istio 流量管理_02"></p>
<hr>
<h1 id="3-故障注入之中止"><a href="#3-故障注入之中止" class="headerlink" title="3 故障注入之中止"></a>3 故障注入之中止</h1><p>​    上章介绍了故障注入原理和实操，知道了故障注入多用在两个场景：</p>
<blockquote>
<p>延迟：模拟增加网络延迟或上游服务过载</p>
<p>中止：模拟服务故障而导致调用服务不可用。中止通常以 HTTP 错误代码或 TCP 连接失败表示</p>
</blockquote>
<p>​    在上节中已经介绍了故障注入延迟的实例，这节重点介绍故障注入的中止。</p>
<hr>
<h1 id="4-Istio-故障注入之中止实例"><a href="#4-Istio-故障注入之中止实例" class="headerlink" title="4 Istio 故障注入之中止实例"></a>4 Istio 故障注入之中止实例</h1><p>​    本实例包括 4 个资源文件，3 个 k8s 相关，1 个 istio 相关：</p>
<blockquote>
<p>jiuxi-client.yaml</p>
<p>jiuxi-nginx-svc.yaml</p>
<p>jiuxi-nginx-deploy.yaml</p>
<p>jiuxi-nginx-vs.yaml</p>
</blockquote>
<h2 id="4-1-客户端资源文件"><a href="#4-1-客户端资源文件" class="headerlink" title="4.1 客户端资源文件"></a>4.1 客户端资源文件</h2><p>​    jiuxi-client.yaml 内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589954889697928.png" alt="第三十四章 九析带你轻松完爆 Istio - fault injection 故障注入之中止_istio 视频_03"></p>
<p>​    执行如下语句进行 Istio 注入，注入后，此 client 将处于网格之内：</p>
<blockquote>
<p>istioctl kube-inject -f jiuxi-client.yaml | kubectl apply -f -</p>
</blockquote>
<p>​    Istio 注入成功成功如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589954895184626.png" alt="第三十四章 九析带你轻松完爆 Istio - fault injection 故障注入之中止_istio 视频_04"></p>
<h2 id="4-2-k8s-服务文件"><a href="#4-2-k8s-服务文件" class="headerlink" title="4.2 k8s 服务文件"></a>4.2 k8s 服务文件</h2><p>​    jiuxi-nginx-svc.yaml 内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589954902303383.png" alt="第三十四章 九析带你轻松完爆 Istio - fault injection 故障注入之中止_istio fault inject_05"></p>
<p>​    执行如下语句部署 service：</p>
<blockquote>
<p>kubectl apply -f jiuxi-nginx-svc.yaml</p>
</blockquote>
<h2 id="4-3-部署工作负载（deployment）"><a href="#4-3-部署工作负载（deployment）" class="headerlink" title="4.3 部署工作负载（deployment）"></a>4.3 部署工作负载（deployment）</h2><p>​    jiuxi-nginx-deploy.yaml 内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589954910549427.png" alt="第三十四章 九析带你轻松完爆 Istio - fault injection 故障注入之中止_istio fault inject_06"></p>
<p>​    部署语句如下：</p>
<blockquote>
<p>kubectl apply -f jiuxi-nginx-deploy.yaml</p>
</blockquote>
<h2 id="4-4-虚拟服务文件"><a href="#4-4-虚拟服务文件" class="headerlink" title="4.4 虚拟服务文件"></a>4.4 虚拟服务文件</h2><p>​    故障注入就在虚拟服务资源中，内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589954917713253.png" alt="第三十四章 九析带你轻松完爆 Istio - fault injection 故障注入之中止_istio 失败注入_07"></p>
<p>​    部署语句如下：</p>
<blockquote>
<p>kubectl apply -f jiuxi-nginx-vs.yaml</p>
</blockquote>
<p>​    自此，整个实例部署完毕。</p>
<hr>
<h1 id="5-验证故障注入"><a href="#5-验证故障注入" class="headerlink" title="5 验证故障注入"></a>5 验证故障注入</h1><p>​    执行如下语句登录客户端：</p>
<blockquote>
<p>kubectl exec -it client-5b77d5949f-clrb7 – sh</p>
</blockquote>
<p>​    使用 wget 访问 nginx-svc：</p>
<blockquote>
<p>wget -q -O - <a target="_blank" rel="noopener" href="http://nginx-svc/"> http://nginx-svc</a></p>
</blockquote>
<p>​    发现模拟后端服务中止失效。如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589954925218922.png" alt="第三十四章 九析带你轻松完爆 Istio - fault injection 故障注入之中止_istio 流量管理_08"></p>
<p>​    自此，九析带你轻松完爆故障注入之中止。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-fault-injection-%E6%95%85%E9%9A%9C%E6%B3%A8%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bb.jpg">
      <meta itemprop="name" content="九析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九析">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 九析">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-fault-injection-%E6%95%85%E9%9A%9C%E6%B3%A8%E5%85%A5/" class="post-title-link" itemprop="url">九析带你轻松完爆 Istio - fault injection 故障注入</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-12 10:36:10 / 修改时间：10:39:08" itemprop="dateCreated datePublished" datetime="2021-09-12T10:36:10+08:00">2021-09-12</time>
    </span>

  
    <span id="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-fault-injection-%E6%95%85%E9%9A%9C%E6%B3%A8%E5%85%A5/" class="post-meta-item leancloud_visitors" data-flag-title="九析带你轻松完爆 Istio - fault injection 故障注入" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1 前言</p>
<p>2 邀约</p>
<p>3 故障注入简介</p>
<p>4 Istio 故障注入</p>
<p>5 Istio 故障注入实例</p>
<p>  5.1 客户端资源文件</p>
<p>  5.2 k8s 服务文件</p>
<p>  5.3 部署工作负载（deployment）</p>
<p>  5.4 虚拟服务文件</p>
<p>6 验证故障注入</p>
<hr>
<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>​    如果你对博客有任何疑问，请告诉我。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589943444388659.png" alt="第三十三章 九析带你轻松完爆 Istio - fault injection 故障注入_Istio 故障注入"></p>
<hr>
<h1 id="2-邀约"><a href="#2-邀约" class="headerlink" title="2 邀约"></a>2 邀约</h1><p>​    你可以从 b 站搜索 “九析”，获取免费的、更生动的视频资料：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589943453222671.png" alt="第三十三章 九析带你轻松完爆 Istio - fault injection 故障注入_istio 教程_02"></p>
<hr>
<h1 id="3-故障注入简介"><a href="#3-故障注入简介" class="headerlink" title="3 故障注入简介"></a>3 故障注入简介</h1><p>​    很多年前，我看过这样一部电影：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589943462847897.png" alt="第三十三章 九析带你轻松完爆 Istio - fault injection 故障注入_istio 教程_04"></p>
<p>​    没错，周星驰演得，逃学威龙2。电影的开头讲述了周星驰的飞虎队执行反恐演习，在最后却误射了可爱的小骚妹。</p>
<p>​    但是这跟故障注入有神马关系呢？</p>
<p>​    周星驰的反恐演习其实并不是真的反恐，而只是演习；故障注入本身也并没有故障，而是人为引入故障。这种机制都是为了测试和提高体系健壮性的手段。</p>
<p>​    在程序开发过程中，我们经常会有这样的场景，比如要测试调用第三方服务失败后系统的反应，或者上游服务雪崩时下游服务逻辑处理等。如果没有故障注入，那么我们就只能采用断网、压测等手段模拟故障，但是这样的操作实在费事费力，一点都不随风。</p>
<hr>
<h1 id="4-Istio-故障注入"><a href="#4-Istio-故障注入" class="headerlink" title="4 Istio 故障注入"></a>4 Istio 故障注入</h1><p>​    Istio 故障注入与其他在网络层引入错误（例如延迟数据包或者直接杀死 Pod）的机制不同，Istio 允许在应用程序层注入故障。这使得可以注入更多相关的故障，比如 HTTP 错误代码等。</p>
<p>​    Istio 可以注入两种类型的故障，而这两种故障都是使用虚拟服务来配置的：</p>
<blockquote>
<p>延迟：模拟增加网络延迟或上游服务过载。</p>
<p>中止：模拟服务故障而导致调用服务不可用。中止通常以 HTTP 错误代码或 TCP 连接失败表示</p>
</blockquote>
<hr>
<h1 id="5-Istio-故障注入实例"><a href="#5-Istio-故障注入实例" class="headerlink" title="5 Istio 故障注入实例"></a>5 Istio 故障注入实例</h1><p>​    本实例包括 4 个资源文件，3 个 k8s 相关，1 个 istio 相关：</p>
<blockquote>
<p>jiuxi-client.yaml    </p>
<p>jiuxi-nginx-svc.yaml        </p>
<p>jiuxi-nginx-deploy.yaml</p>
<p>jiuxi-nginx-vs.yaml</p>
</blockquote>
<h2 id="5-1-客户端资源文件"><a href="#5-1-客户端资源文件" class="headerlink" title="5.1 客户端资源文件"></a>5.1 客户端资源文件</h2><p>​    jiuxi-client.yaml 内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589943486418393.png" alt="第三十三章 九析带你轻松完爆 Istio - fault injection 故障注入_Istio 失败注入_06"></p>
<p>​    执行如下语句进行 Istio 注入，注入后，此 client 将处于网格之内：</p>
<blockquote>
<p>istioctl kube-inject -f jiuxi-client.yaml | kubectl apply -f -</p>
</blockquote>
<p>​    Istio 注入成功成功如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589943499357696.png" alt="第三十三章 九析带你轻松完爆 Istio - fault injection 故障注入_istio 教程_08"></p>
<h2 id="5-2-k8s-服务文件"><a href="#5-2-k8s-服务文件" class="headerlink" title="5.2 k8s 服务文件"></a>5.2 k8s 服务文件</h2><p>​    jiuxi-nginx-svc.yaml 内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589943507931635.png" alt="第三十三章 九析带你轻松完爆 Istio - fault injection 故障注入_Istio 失败注入_10"></p>
<p>​    执行如下语句部署 service：</p>
<blockquote>
<p>kubectl apply -f jiuxi-nginx-svc.yaml</p>
</blockquote>
<h2 id="5-3-部署工作负载（deployment）"><a href="#5-3-部署工作负载（deployment）" class="headerlink" title="5.3 部署工作负载（deployment）"></a>5.3 部署工作负载（deployment）</h2><p>​    jiuxi-nginx-deploy.yaml 内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589943513722118.png" alt="第三十三章 九析带你轻松完爆 Istio - fault injection 故障注入_istio 教程_12"></p>
<p>​    部署语句如下：</p>
<blockquote>
<p>kubectl apply -f jiuxi-nginx-deploy.yaml</p>
</blockquote>
<h2 id="5-4-虚拟服务文件"><a href="#5-4-虚拟服务文件" class="headerlink" title="5.4 虚拟服务文件"></a>5.4 虚拟服务文件</h2><p>​    故障注入就在虚拟服务资源中，内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589943521891904.png" alt="第三十三章 九析带你轻松完爆 Istio - fault injection 故障注入_Istio fault inject_14"></p>
<p>​    部署语句如下：</p>
<blockquote>
<p>kubectl apply -f jiuxi-nginx-vs.yaml</p>
</blockquote>
<p>​    自此，整个实例部署完毕。</p>
<hr>
<h1 id="6-验证故障注入"><a href="#6-验证故障注入" class="headerlink" title="6 验证故障注入"></a>6 验证故障注入</h1><p>​    执行如下语句登录客户端：</p>
<blockquote>
<p>kubectl exec -it client-5b77d5949f-clrb7 – sh</p>
</blockquote>
<p>​    使用 wget 访问 nginx-svc：</p>
<blockquote>
<p>wget -q -O - <a target="_blank" rel="noopener" href="http://nginx-svc/"> http://nginx-svc</a></p>
</blockquote>
<p>​    发现延迟生效，因为设置的延迟时间是 5s。除去我中间操作花去了大约 3s，发现最终的延迟确实是 5s。如下图所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589943531644226.png" alt="第三十三章 九析带你轻松完爆 Istio - fault injection 故障注入_Istio fault inject_16"></p>
<p>​    自此，九析带你轻松完爆了 Istio 故障注入。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-configmap-istio-ca-root-cer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bb.jpg">
      <meta itemprop="name" content="九析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九析">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 九析">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-configmap-istio-ca-root-cer/" class="post-title-link" itemprop="url">九析带你轻松完爆 Istio - configmap istio-ca-root-cer</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-12 10:33:41 / 修改时间：10:34:14" itemprop="dateCreated datePublished" datetime="2021-09-12T10:33:41+08:00">2021-09-12</time>
    </span>

  
    <span id="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-configmap-istio-ca-root-cer/" class="post-meta-item leancloud_visitors" data-flag-title="九析带你轻松完爆 Istio - configmap istio-ca-root-cer" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1 前言</p>
<p>2 邀约</p>
<p>3 错误现象</p>
<p>4 解决方案</p>
<hr>
<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>​    如果你对博客有任何疑问，请告诉我。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589879701743186.png" alt="第三十二章 九析带你轻松完爆 Istio - configmap istio-ca-root-cer_istiod-ca-cert"></p>
<hr>
<h1 id="2-邀约"><a href="#2-邀约" class="headerlink" title="2 邀约"></a>2 邀约</h1><p>​    你可以从 b 站搜索 “九析”，获取免费的、更生动的视频资料：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589879708134145.png" alt="第三十二章 九析带你轻松完爆 Istio - configmap istio-ca-root-cer_istio 视频_02"></p>
<hr>
<h1 id="3-错误现象"><a href="#3-错误现象" class="headerlink" title="3 错误现象"></a>3 错误现象</h1><p>​    Istio 升级到 1.5.x，当新创建命名空间，在该命名空间中对工作负载进行 Istio 注入（自动或手动），出现 configmap 挂载错误：</p>
<blockquote>
<p>SetUp failed for volume “istiod-ca-cert” : configmap “istio-ca-root-cert” not found.</p>
</blockquote>
<hr>
<h1 id="4-解决方案"><a href="#4-解决方案" class="headerlink" title="4 解决方案"></a>4 解决方案</h1><p>​    执行如下语句：</p>
<blockquote>
<p>kubectl rollout restart istiod -n istion-system</p>
</blockquote>
<p>​    kubectl rollout 命令是对资源进行管理，restart 表示重启资源。因此上面的命令作用是重启 istiod。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E6%9C%8D%E5%8A%A1%E6%9D%A1%E7%9B%AE-ServiceEntry-%E5%AE%9E%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bb.jpg">
      <meta itemprop="name" content="九析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="九析">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 九析">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E6%9C%8D%E5%8A%A1%E6%9D%A1%E7%9B%AE-ServiceEntry-%E5%AE%9E%E4%BE%8B/" class="post-title-link" itemprop="url">九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-12 10:29:08 / 修改时间：10:32:15" itemprop="dateCreated datePublished" datetime="2021-09-12T10:29:08+08:00">2021-09-12</time>
    </span>

  
    <span id="/2021/09/12/%E4%B9%9D%E6%9E%90%E5%B8%A6%E4%BD%A0%E8%BD%BB%E6%9D%BE%E5%AE%8C%E7%88%86-Istio-%E6%9C%8D%E5%8A%A1%E6%9D%A1%E7%9B%AE-ServiceEntry-%E5%AE%9E%E4%BE%8B/" class="post-meta-item leancloud_visitors" data-flag-title="九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1 前言</p>
<p>2 邀约</p>
<p>3 服务条目（Service Entries）介绍</p>
<p>4 服务条目样例</p>
<p>  4.1 服务条目资源</p>
<p>  4.2 istio 注入客户端资源</p>
<p>5 验证服务条目样例</p>
<p>  5.1 登录 client</p>
<p>  5.2 调整 service entiries 解析类型</p>
<p>6 总结</p>
<hr>
<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h1><p>​    如果你对博客有任何疑问，请告诉我。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589874028884872.png" alt="第三十一章 九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例_istio 服务条目"></p>
<hr>
<h1 id="2-邀约"><a href="#2-邀约" class="headerlink" title="2 邀约"></a>2 邀约</h1><p>​    你可以从 b 站搜索 “九析”，获取免费的、更生动的视频资料：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589874036233340.png" alt="第三十一章 九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例_istio service entry_02"></p>
<hr>
<h1 id="3-服务条目（Service-Entries）介绍"><a href="#3-服务条目（Service-Entries）介绍" class="headerlink" title="3 服务条目（Service Entries）介绍"></a>3 服务条目（Service Entries）介绍</h1><p>​    使用服务条目资源（Service Entries）可以将条目添加到 Istio 内部维护的服务注册表中。添加服务条目后，Envoy  代理可以将流量发送到该服务，就好像该服务条目是网格中的服务一样。通过配置服务条目，可以管理在网格外部运行的服务的流量。</p>
<p>​    此外，可以配置虚拟服务和目标规则，以更精细的方式控制到服务条目的流量，就像为网格中的其他任何服务配置流量一样。</p>
<hr>
<h1 id="4-服务条目样例"><a href="#4-服务条目样例" class="headerlink" title="4 服务条目样例"></a>4 服务条目样例</h1><p>​    上面的介绍有点晦涩，不如我们直接给一个样例出来，该样例包含两个资源文件：</p>
<blockquote>
<p>jiuxi-client.yaml    # istio 要注入的客户端资源文件</p>
<p>jiuxi-svc-entry.yaml    # 服务条目资源文件</p>
</blockquote>
<h2 id="4-1-服务条目资源"><a href="#4-1-服务条目资源" class="headerlink" title="4.1 服务条目资源"></a>4.1 服务条目资源</h2><p>​    jiuxi-svc-entry.yaml 内容如下：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589874045559306.png" alt="第三十一章 九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例_istio service entry_04"></p>
<p>​    该服务条目资源定义了一个外部网站 baidu，并将它纳入到 Istio 内部维护的服务注册表中。执行如下语句创建 service entry 资源：</p>
<blockquote>
<p>kubectl apply -f jiuxi-svc-entry.yaml</p>
</blockquote>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589874053316318.png" alt="第三十一章 九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例_istio traffic manag_06"></p>
<h2 id="4-2-istio-注入客户端资源"><a href="#4-2-istio-注入客户端资源" class="headerlink" title="4.2 istio 注入客户端资源"></a>4.2 istio 注入客户端资源</h2><p>​    jiuxi-client.yaml 客户端资源文件如下：</p>
<p><img src="https://blog.51cto.com/static/js/ueditor1.4.3/themes/default/images/spacer.gif" alt="第三十一章 九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例_istio 流量管理_03"></p>
<p>​    编辑完，执行如下语句进行 Istio 注入：</p>
<blockquote>
<p>istioctl kube-inject -f jiuxi-client.yaml | kubectl apply -f -</p>
</blockquote>
<p>​    执行成功后，查看 pod 发现容器个数为 2 个，说明 istio 注入成功：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589874101280021.png" alt="第三十一章 九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例_istio service entry_10"></p>
<p>​    Istio 注入后，client 就处于 Istio 服务网格之中。</p>
<hr>
<h1 id="5-验证服务条目样例"><a href="#5-验证服务条目样例" class="headerlink" title="5 验证服务条目样例"></a>5 验证服务条目样例</h1><h2 id="5-1-登录-client"><a href="#5-1-登录-client" class="headerlink" title="5.1 登录 client"></a>5.1 登录 client</h2><p>​    执行如下语句登录 client：</p>
<blockquote>
<p>kubectl exec -it $(kubectl get pods | grep -i client | awk ‘{print $1}’) – sh</p>
</blockquote>
<p>​    登陆 client，访问 <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> 成功，如下所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589874108331494.png" alt="第三十一章 九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例_istio 视频_12"></p>
<p>​    你可能会迷惑，难道这就是服务条目？不是访问外网吗？</p>
<p>​    好吧，这还就真是服务条目。为了解除你心中的疑惑，我们现在来对刚才编写的 service entries 资源做一些手脚。</p>
<h2 id="5-2-调整-service-entiries-解析类型"><a href="#5-2-调整-service-entiries-解析类型" class="headerlink" title="5.2 调整 service entiries 解析类型"></a>5.2 调整 service entiries 解析类型</h2><p>​    调整内容如下所示：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589874117646658.png" alt="第三十一章 九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例_istio 视频_14"></p>
<p>​    添加了域名解析类型为 static，同时给出一个自定义 IP：192.168.182.188。再次 kubectl apply 后登陆 client 查看：</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589874124875325.png" alt="第三十一章 九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例_istio 流量管理_16"></p>
<p>​    再次访问 baidu，发现已经不会成功了，多试验几次，一样不会成功。</p>
<p>​    出现此问题的原因是，service entry 一直都在发挥作用，前面没报错的原因是默认指定的域名解析是基于 DNS  的。而调整后，我们设置了静态域名解析的方式，并随意给了一个内网 IP 来标识 baidu。kubectl apply service entry 后此配置立刻就被应用在网格内（client）的 envoy，那么在网格内访问 baidu 的时候，流量就被路由到了我们所指定的  192.168.182.188 去了。</p>
<p>​    执行如下语句删除 service entry，再次登录 client 访问 baidu，发现岁月静好。</p>
<p><img src="https://gitee.com/jianshen-bao/blog-img/raw/master/img/1589874132638545.png" alt="第三十一章 九析带你轻松完爆 Istio - 服务条目 ServiceEntry 实例_istio traffic manag_18"></p>
<hr>
<h1 id="6-总结"><a href="#6-总结" class="headerlink" title="6 总结"></a>6 总结</h1><p>​    使用 service entry  使用场景有哪些？九析这里给你一个场景，比如工作过程中你需要调用外部合作方服务，该服务跟你的集群毫无关系，甚至对方服务可以布置在美国。但是通过服务条目，你可以将对方服务纳入到自己的 Istio 网格之内，就像它本身存在你的集群之内一样，就好像你做了内网拦截一样。而且服务条目可以结合虚拟服务（virtual  service）、目的地规则（destination rule）做更加精细的流量控制，不仅如此，还可以做失败注入、重试等功能。</p>
<p>​    自此，九析带你轻松完爆 service entry。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2020 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">九析</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":null,"app_key":null,"server_url":null,"security":true}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>



</body>
</html>
